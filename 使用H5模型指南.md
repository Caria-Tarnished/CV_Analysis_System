# 如何使用 .h5 格式的模型

## ? 好消息

我们的系统**已经支持 .h5 格式**！不需要转换，直接使用即可。

## ? 快速使用步骤

### 第1步：安装TensorFlow

```bash
# 安装TensorFlow（CPU版本）
pip install tensorflow

# 或者安装轻量版（推荐）
pip install tensorflow-cpu
```

**安装时间**：约2-5分钟，需要约500MB磁盘空间

### 第2步：下载并放置.h5模型

1. 从Kaggle下载 `.h5` 模型文件
2. 重命名为 `emotion_model.h5`（注意扩展名是 .h5）
3. 放到 `CV_Analysis_System/models/` 目录

### 第3步：修改代码使其加载.h5模型

打开 `main_gui.py`，找到第81行左右：

```python
model_path = "models/emotion_model.pth"
```

改为：

```python
model_path = "models/emotion_model.h5"
```

### 第4步：启动系统

```bash
cd CV_Analysis_System
python run_system.py
```

系统会自动识别并加载 .h5 格式的模型！

---

## ? 方案2：转换为PyTorch格式（可选）

如果你想转换为 `.pth` 格式，可以使用转换脚本。

### 为什么要转换？

- ? PyTorch模型加载更快
- ? 不需要安装TensorFlow（节省空间）
- ? 更好的兼容性

### 使用转换脚本

我们提供了转换脚本 `convert_h5_to_pth.py`：

```bash
cd CV_Analysis_System
python convert_h5_to_pth.py --h5_model models/emotion_model.h5 --output models/emotion_model.pth
```

---

## ? 注意事项

### 模型架构兼容性

.h5 模型必须满足以下条件：

1. **输入**：48x48 灰度图像
2. **输出**：7个类别（愤怒、厌恶、恐惧、高兴、悲伤、惊讶、中性）
3. **类别顺序**：与FER2013数据集一致

### 常见问题

**Q1: 如何知道.h5模型是否兼容？**

查看模型的描述或README，确认：
- 训练数据集：FER2013
- 输入尺寸：48x48
- 类别数量：7

**Q2: TensorFlow安装失败怎么办？**

尝试：
```bash
# 使用清华镜像源
pip install tensorflow -i https://pypi.tuna.tsinghua.edu.cn/simple

# 或安装特定版本
pip install tensorflow==2.13.0
```

**Q3: 加载.h5模型时报错？**

检查：
1. TensorFlow是否正确安装：`python -c "import tensorflow; print(tensorflow.__version__)"`
2. 模型文件是否完整下载
3. 模型架构是否与系统兼容

---

## ? 完整示例流程

### 从Kaggle下载并使用.h5模型

```bash
# 1. 安装TensorFlow
pip install tensorflow-cpu

# 2. 下载模型后，放到正确位置
# models/emotion_model.h5

# 3. 修改 main_gui.py 中的模型路径为 .h5

# 4. 测试模型加载
cd CV_Analysis_System
python -c "from emotion_recognizer import EmotionRecognizer; r = EmotionRecognizer('models/emotion_model.h5'); print('? 模型加载成功!')"

# 5. 启动系统
python run_system.py
```

---

## ? 性能对比

| 格式 | 加载速度 | 推理速度 | 依赖大小 |
|------|---------|---------|---------|
| .h5 (TensorFlow) | 较慢 | 中等 | ~500MB |
| .pth (PyTorch) | 快 | 快 | ~100MB |

**建议**：
- 如果已经有.h5模型：先直接用，再考虑转换
- 如果从零开始：建议自己训练得到.pth模型

---

## ? 推荐Kaggle资源

搜索这些关键词找到高质量的.h5模型：

1. "FER2013 keras model"
2. "emotion recognition h5"
3. "facial expression h5 trained"

选择标准：
- ? 下载量高
- ? 有清晰的说明文档
- ? 准确率60%以上
- ? 最近更新（2023年后）

---

**提示**：直接使用.h5是最快的方法，不需要复杂的转换过程！

